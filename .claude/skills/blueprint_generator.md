# Skill: blueprint_generator

## Description
Generate cloud-native blueprints for microservices, infrastructure, and deployment pipelines.

## Instructions
This skill defines standards and templates for scaffolding cloud-native applications. It focuses on 12-factor app principles, Kubernetes-readiness, and standardized infrastructure patterns.

## Blueprint Categories

1. **Service Blueprint:** Standard microservice structure (FastAPI/Express/Go).
2. **Infrastructure Blueprint:** Terraform/Pulumi patterns for cloud resources.
3. **Observability Blueprint:** Monitoring, logging, and tracing configurations.
4. **Platform Blueprint:** Kubernetes manifests and Helm charts.

## Service Architecture (12-Factor Pattern)

### 1. Minimal FastAPI Service Blueprint
```python
# .blueprint/service/python/app/main.py
from fastapi import FastAPI
from .api import v1
from .core.config import settings

def create_app() -> FastAPI:
    app = FastAPI(title=settings.PROJECT_NAME)

    # Health check endpoint (Required for K8s)
    @app.get("/healthz")
    async def health():
        return {"status": "healthy"}

    app.include_router(v1.router, prefix="/api/v1")
    return app
```

### 2. Standard Configuration (.env.example)
```bash
# Core
PROJECT_NAME=todo-service
ENVIRONMENT=production
DEBUG=false

# Database
DATABASE_URL=postgresql://user:pass@localhost:5432/db

# Event Bus
KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# Security
SECRET_KEY=change-me-in-production
ALLOWED_HOSTS=["*"]
```

## Infrastructure Blueprint (Terraform)

**Core Concept:** Modular infrastructure for reproducible environments.

```hcl
# .blueprint/infra/aws/main.tf
module "vpc" {
  source = "terraform-aws-modules/vpc/aws"
  name   = "${var.project_name}-vpc"
  cidr   = "10.0.0.0/16"
}

module "eks" {
  source  = "terraform-aws-modules/eks/aws"
  cluster_name    = "${var.project_name}-cluster"
  cluster_version = "1.28"
  vpc_id          = module.vpc.vpc_id
  subnet_ids      = module.vpc.private_subnets
}

module "database" {
  source = "./modules/rds"
  count  = var.enable_db ? 1 : 0
  vpc_id = module.vpc.vpc_id
}
```

## Platform Blueprint (Kubernetes)

### 1. Standard Deployment Blueprint
```yaml
# .blueprint/platform/k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ service_name }}
spec:
  replicas: {{ replicas }}
  template:
    spec:
      containers:
      - name: app
        image: {{ image_repo }}:{{ image_tag }}
        resources:
          requests: { cpu: "100m", memory: "256Mi" }
          limits: { cpu: "500m", memory: "512Mi" }
        livenessProbe:
          httpGet: { path: /healthz, port: 8000 }
        envFrom:
        - configMapRef: { name: {{ service_name }}-config }
```

## CI/CD Pipeline Blueprint (GitHub Actions)

```yaml
# .blueprint/cicd/github/pipeline.yml
name: Pipeline

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Tests
        run: make test

  build-and-push:
    needs: test
    steps:
      - name: Login to GHCR
        uses: docker/login-action@v3
      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          push: true
          tags: user/repo:latest

  deploy:
    needs: build-and-push
    steps:
      - name: Trigger CD
        run: |
          # ArgoCD / FluxCD trigger logic
```

## Usage Logic

1. **Scaffold Service:** `blueprint_generator scaffold --type=python-fastapi --name=auth-service`
2. **Generate Infra:** `blueprint_generator infra --provider=aws --modules=eks,rds,s3`
3. **Apply Platform:** `blueprint_generator platform --type=helm --values=prod.yaml`

## Best Practices

1. **Immutable Infrastructure:** Never change resources manually; use the blueprint.
2. **Stateless Services:** Ensure services store state in external databases/caches.
3. **Secret Management:** Blueprints must use Secret Manager references (Vault/AWS SM), never raw secrets.
4. **Standardized Tags:** All resources generated by a blueprint should have consistent metadata (Project, Env, Owner).
5. **Security by Default:** Enable TLS, Least Privilege IAM, and Network Policies in the blueprints.

## Blueprint Validation
Every generated blueprint should pass:
- **Linting:** (Ruff/ESLint)
- **Security Scan:** (Trivy/Snyk)
- **IaC Check:** (Terrascan/Checkov)
